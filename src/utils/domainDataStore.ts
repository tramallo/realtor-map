import { create } from "zustand";

import { CreateProperty, Property, UpdateProperty } from "./domainSchemas";
import { testProperties } from "./testData";

interface PropertyStore {
    properties: Property[],
    createProperty: (newPropertyData: CreateProperty) => Promise<Error | void>,
    removeProperty: (propertyId: Property['id']) => Promise<Error | void>,
    updateProperty: (propertyId: Property['id'], updatedProperty: UpdateProperty) => Promise<Error | void>
}

export const usePropertyStore = create<PropertyStore>((set) => ({
    properties: testProperties,
    createProperty: async (newPropertyData) => set((prevState) => {
        // this data is generated by the db
        const newId: string = new Date().getTime().toString();
        const newProperty: Property = {
            id: newId,
            ...newPropertyData
        }

        return { properties: [...prevState.properties, newProperty] }
    }),
    removeProperty: async (propertyId) => set((prevState) => ({
        properties: prevState.properties.filter((property) => property.id != propertyId)
    })),
    updateProperty: async (propertyId, updatedProperty) => set((prevState) => ({
        properties: prevState.properties.map((property) => property.id == propertyId ? { ...property, ...updatedProperty } : property)
    })),
}))
